<?xml version="1.0" encoding="utf-8" ?>
<UserControl
    x:Class="INotify.View.NotificationListControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="using:INotify.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:INotify.View"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:model="using:INotifyLibrary.Model" xmlns:entity="using:INotifyLibrary.Model.Entity"
    Loaded="UserControl_Loaded"
    Unloaded="UserControl_Unloaded"
    mc:Ignorable="d">

    <UserControl.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <converters:CountToVisibilityConverter x:Key="CountToVisibilityConverter" />
        <converters:CountToReverseVisibilityConverter x:Key="CountToReverseVisibilityConverter" />

        <!--  Notification Item Template  -->
        <DataTemplate x:Key="NotificationItemTemplate" x:DataType="model:KToastBObj">
            <Border
                Margin="0,4"
                Padding="16"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                CornerRadius="8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!--  App Icon  -->
                    <Image
                        Grid.Column="0"
                        Width="32"
                        Height="32"
                        Margin="0,0,12,0"
                        Source="{x:Bind ToastPackageProfile.LogoFilePath}" />

                    <!--  Notification Content  -->
                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock
                            FontWeight="SemiBold"
                            Text="{x:Bind NotificationData.NotificationTitle}"
                            TextTrimming="CharacterEllipsis" />
                        <TextBlock
                            FontSize="12"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            MaxLines="2"
                            Text="{x:Bind NotificationData.NotificationMessage}"
                            TextTrimming="CharacterEllipsis" />
                        <TextBlock
                            Margin="0,4,0,0"
                            FontSize="11"
                            Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                            Text="{x:Bind ToastPackageProfile.AppDisplayName}" />
                    </StackPanel>

                    <!--  Time  -->
                    <TextBlock
                        Grid.Column="2"
                        VerticalAlignment="Top"
                        FontSize="11"
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Text="{x:Bind NotificationData.DisplayTime}" />
                </Grid>
            </Border>
        </DataTemplate>

        <!--  Package Item Template  -->
        <DataTemplate x:Key="PackageItemTemplate" x:DataType="entity:KPackageProfile">
            <Border
                Margin="0,4"
                Padding="16"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                CornerRadius="8">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!--  App Icon  -->
                    <Image
                        Grid.Column="0"
                        Width="40"
                        Height="40"
                        Margin="0,0,16,0"
                        Source="{x:Bind LogoFilePath}" />

                    <!--  Package Content  -->
                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock
                            FontWeight="SemiBold"
                            Text="{x:Bind AppDisplayName}"
                            TextTrimming="CharacterEllipsis" />
                        <TextBlock
                            FontSize="12"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="{x:Bind AppDescription}"
                            TextTrimming="CharacterEllipsis" />
                    </StackPanel>

                    <!--  Package ID  -->
                    <TextBlock
                        Grid.Column="2"
                        VerticalAlignment="Center"
                        FontSize="10"
                        Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                        Text="{x:Bind PackageFamilyName}" />
                </Grid>
            </Border>
        </DataTemplate>
    </UserControl.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Header Section  -->
        <Grid Grid.Row="0" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!--  Title and Count  -->
            <StackPanel Grid.Column="0" VerticalAlignment="Center">
                <TextBlock
                    FontSize="20"
                    FontWeight="SemiBold"
                    Text="{x:Bind _viewModel.ViewDisplayText, Mode=OneWay}" />
                <TextBlock
                    FontSize="12"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Text="{x:Bind CurrentTargetType, Mode=OneWay}" />
            </StackPanel>

            <!--  Toggle View Button  -->
            <Button
                Grid.Column="1"
                Margin="0,0,8,0"
                Click="ToggleViewButton_Click"
                Content="{x:Bind _viewModel.ToggleButtonText}"
                Style="{ThemeResource AccentButtonStyle}" />

            <!--  Refresh Button  -->
            <Button Grid.Column="2" Click="RefreshButton_Click">
                <FontIcon FontSize="16" Glyph="&#xE72C;" />
            </Button>
        </Grid>

        <!--  Content Section  -->
        <Grid Grid.Row="1">
            <!--  Loading Indicator  -->
            <ProgressRing
                Width="50"
                Height="50"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                IsActive="{x:Bind _viewModel.IsLoading, Mode=OneWay}"
                Visibility="{x:Bind _viewModel.IsLoading, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}" />

            <!--  Notifications ListView  -->
            <ListView
                IsItemClickEnabled="True"
                ItemTemplate="{StaticResource NotificationItemTemplate}"
                ItemsSource="{x:Bind _viewModel.Notifications, Mode=OneWay}"
                SelectionMode="None"
                Visibility="{x:Bind ToggleNotificationView(_viewModel.IsPackageView), Mode=OneWay}">
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                        <Setter Property="Padding" Value="0" />
                        <Setter Property="Margin" Value="0" />
                    </Style>
                </ListView.ItemContainerStyle>
            </ListView>

            <!--  Packages ListView  -->
            <ListView
                IsItemClickEnabled="True"
                ItemTemplate="{StaticResource PackageItemTemplate}"
                ItemsSource="{x:Bind _viewModel.Packages, Mode=OneWay}"
                SelectionMode="None"
                Visibility="{x:Bind TogglePackageView(_viewModel.IsPackageView), Mode=OneWay}">
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                        <Setter Property="Padding" Value="0" />
                        <Setter Property="Margin" Value="0" />
                    </Style>
                </ListView.ItemContainerStyle>
            </ListView>

            <!--  Empty State  -->
            <StackPanel
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Visibility="{x:Bind _viewModel.TotalCount, Converter={StaticResource CountToVisibilityConverter}, Mode=OneWay}">
                <TextBlock
                    Margin="0,0,0,8"
                    HorizontalAlignment="Center"
                    FontSize="18"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Text="No items found" />
                <TextBlock
                    HorizontalAlignment="Center"
                    FontSize="12"
                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                    Text="Try adjusting your filters or check back later" />
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
